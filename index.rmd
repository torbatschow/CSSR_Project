---
title: "Drink and Thrive? <br> German Economics of Binge-Drinking"
author: "Torben and Alex"
date: "16 December 2016"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Clear Global environment
rm(list=ls())

# Setting Working directory
try(setwd("/home/torben/GIT/Pair_Assignment_2"), silent = TRUE)
try(setwd("D:/Eigene Datein/Dokumente/Uni/Hertie/Materials/Collaborative Social Science Data Analysis/CSSR_Project"), silent = TRUE)

source("main.R")

# Collect packages/libraries we need:
packages <- c("fontcm", "psych", "plotly", "Zelig")
# can we add a short list so we have an overview for what we need the packages?
# psych allows for summary statistics
# plotly makes html graphs

# install packages if not installed before
for (p in packages) {
  if (p %in% installed.packages()[,1]) {
    require(p, character.only=T)
  }
  else {
    install.packages(p, repos="http://cran.rstudio.com", dependencies = TRUE)
    require(p, character.only=T)
  }
}
rm(p, packages)

# Initiate Label Names
statelist_code <- c("DE-BW", "DE-BY", "DE-BE", "DE-BB", "DE-HB", "DE-HH", 
                    "DE-HE", "DE-MV", "DE-NI", "DE-NW", "DE-RP", "DE-SL",
                    "DE-SN", "DE-ST", "DE-SH", "DE-TH")

statelist_name <- c("Baden-Württemberg", "Bayern", "Berlin", "Brandenburg", 
                    "Bremen", "Hamburg", "Hessen", "Mecklenburg-Vorpommern", 
                    "Niedersachsen", "Nordrhein-Westfalen", "Rheinland-Pfalz", 
                    "Saarland", "Sachsen", "Sachsen-Anhalt", 
                    "Schleswig-Holstein", "Thüringen")
statelist.code.short <- substr(statelist_code, 4, 5)
statelist_cities <- c("DE-BE", "DE-HB", "DE-HH")
statelist_other <- c("DE-BW", "DE-BY", "DE-BB", "DE-HE", "DE-MV", "DE-NI", "DE-NW", "DE-RP", "DE-SL",
                    "DE-SN", "DE-ST", "DE-SH", "DE-TH")
statelist_other_wo_treatment <- c("DE-BY", "DE-BB", "DE-HE", "DE-MV", "DE-NI", "DE-NW", "DE-RP", "DE-SL",
                    "DE-SN", "DE-ST", "DE-SH", "DE-TH")
```

Narrative:




## Introduction

Alcohol has a history of causing both joy and pain. In our research we want to focus on the latter: Alcohol, if consumend in high amounts and/or regularly over a longer period of time, does severe damage to individuals' health [see e.g. @WHO.2014; @Miller.2007]. It is therefore a policy concern not only to identify reasons and motivation for excessive alcohol consumption but also to develop measures to reduce the public health costs associated to this problem.

It is the aim of this paper is to identify factors interacting with alcohol related health problems and to assess alcohol policy interventions against it. Using the example of all German federal states and time series data for different age groups from 2000 to 2014, we will [1] analyse the possible connection between medical diagnoses of alcohol misuse and possibly explanatory socioeconomic factors like regional economic performance and unemployment rates. For this, we will take both short-term and long-term medical consequences of alcohol misuse into account by examining hospital health records on acute alcohol intoxication as well as on alcoholic liver disease. Besides the socio-economic factors mentioned above, we will [2] test the effect of recent policy measures on the German state level on alcohol consumption, namely the ban on alcohol night sales introduced in 2010 in the state of Baden-Wuerttemberg.

We find no conclusive relationship between alcohol-related hospitalizations and socio-economic indicators. However, the reason for this is not necessarily that the relationship does not exist. It is also possible that the small number of observations and the limited availability of relevant indicators prevents our data from generating sufficient insights into the matter. 
Regarding the second topic of investigation, we find that the night sales ban reduces the number of excessive alcohol drinking diagnoses among German youth by about 20%. This finding confirms a prior study by @Marcus.2015 who found a decrease of about 7%. While their study used more detailed data, it focused only on the short-term effects until 2011. Our study in contrast looked at a longer time-horizon, but used more aggregated data.


```{r echo = FALSE, fig.width=8, fig.height=5} 
# Bar diagram: F10.0 cases per 1000 per age group in DE-DE
PL1 <- TOTAL %>% filter(GENDER == "all", AGE!="all", STATE=="DE-DE")
ggplot(data=PL1, aes(x=AGE, y=F100_p1000)) +
  geom_bar(stat="identity", fill = "#1E90FF") +
  xlab("Age Group") +
  ylab("F10.0 cases per 1000 people") +
  ggtitle("") +
  theme_bw() +           # do we want it to be bw or grey?
  guides(fill=FALSE) +
  theme(text  = element_text(colour = "#797979"),
        axis.text.x  = element_text(angle=90, vjust=0.5),
        axis.title.y=element_text(margin=margin(10,10,0,10)))
```


```{r echo = FALSE, fig.width=8, fig.height=5} 
# Bar diagram: K70 cases per 1000 per age group
ggplot(data=PL1, aes(x = AGE, y = K70_p1000, fill = AGE)) +
  geom_bar(stat="identity", fill = "#1E90FF") +
  xlab("Age Group") +
  ylab("K70 cases per 1000 people") +
  ggtitle("") +
  guides(fill=FALSE) +
  theme_bw() +
  theme(text  = element_text(colour = "#797979"),
        axis.text.x  = element_text(angle=90, vjust=0.5),
        axis.title.y=element_text(margin=margin(10,10,0,10)))
```

```{r echo = FALSE, fig.width=4, fig.height=5, out.width=c('350px', '350px')} 
spplot(map.Germany.2000.F100_p1000, 
       zcol = "value", 
       col.regions = colors,
       main=list(label="2000: F10.0 diagnoses\nper 1000 pp all age groups"),
       at = seq(0, 2.2, by = 0.1))
spplot(map.Germany.2014.F100_p1000, 
       zcol = "value", 
       col.regions = colors,
       main=list(label="2014: F10.0 diagnoses\nper 1000 pp all age groups"),
       at = seq(0, 2.2, by = 0.1),
       colorkey=FALSE)
```


```{r echo = FALSE} 
#  data frame for plot
DS0 <- TOTAL %>% filter(GENDER == "all", AGE=="15-19y") %>% 
  select(STATE, YEAR, F100_p1000, F102_p1000, K70_p1000)
DS0$GROUP <- "Non-City States"
DS0$GROUP[DS0$STATE == "DE-BW"] <- "Treatment"
DS0$GROUP[DS0$STATE == "DE-BE" | DS0$STATE == "DE-HB" | DS0$STATE == "DE-HH"] <- "City"

# Start with Treatment
  F100Plot.age15 <- plot_ly(data = filter(DS0, STATE == "DE-BW"),
                    x = ~YEAR,
                    y = ~F100_p1000,
                    type = "scatter",
                    mode = "lines",
                    name = "Treatment State BW",
                    #color = ~GROUP[1],
                    legendgroup = ~GROUP[1],
                    line = list(color = "red", width = 4)) %>%
                  layout(title = "Hospitalizations due to alcohol intoxination among 15-19 year olds",
                           xaxis = list(title = "Year", titlefont = list(size = 18)),
                           yaxis = list(title = "F10.0 cases per 1000 people", titlefont = list(size = 18)),
                          legend = list(font = list(size = 14)))

# Non-City States
for (i in 1:12){
F100Plot.age15 <- add_trace(F100Plot.age15, 
                        data = filter(DS0, STATE == statelist_other_wo_treatment[i]), 
                        text = ~STATE[1], 
                        legendgroup = ~GROUP[1], 
                        name = paste("State", substr(statelist_other_wo_treatment[i], 4, 5)),
                        line = list(color = colorRampPalette(brewer.pal(9, "Greys"))(16)[i+4], width = 2))
}
# City States
for (i in 1:3){
  F100Plot.age15 <- add_trace(F100Plot.age15, 
                        data = filter(DS0, STATE == statelist_cities[i]), 
                        line = list(color = colorRampPalette(brewer.pal(5, "Blues"))(5)[i+2], width = 2),
                        name = paste("City State", substr(statelist_cities[i], 4, 5)))
}
```

```{r echo = FALSE}   
F100Plot.age15
```

Marcus and Sielder (2014) find about 7% decrease, we find about 20% decrease

```{r echo = FALSE} 
plot_ly(bancomparison, x = ~YEAR, y = ~WBAN, type = 'bar', name = 'With Ban') %>%
  add_trace(y = ~WOBAN, name = 'Without Ban') %>%
  layout(xaxis = list(title = 'Year', titlefont = list(size = 18)), 
         yaxis = list(title = 'F10.0 Cases for 15 to 19 year-olds in DE-BW',
                      titlefont = list(size = 18)),
         legend = list(x = 0.8, y = 1, font = list(size = 18)),
         barmode = 'group')
```
